<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>OAuth 2.0 Authorization Framework</title>
<link href="../static/favicon.ico" rel="icon" type="image/x-icon"/>
<link href="../static/pygments.css" rel="stylesheet" type="text/css"/>
<link href="../static/page.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<nav>
<a href="../">Home</a>
      ·
      <span class="dropdown">
<a href="#">Lessons</a>
<span class="dropdown-content" id="nav-lessons">
<a href="../intro/">Introduction</a>
<a href="../oauth/">OAuth</a>
<a href="../msgque/">A Message Queue</a>
<a href="../distlock/">Distributed Locks</a>
<a href="../eventual/">Eventually Consistent Key-Value Store</a>
<a href="../worksteal/">Work-Stealing Scheduler</a>
<a href="../crdt/">Conflict-Free Replicated Data Types</a>
<a href="../mapreduce/">MapReduce</a>
<a href="../finale/">Conclusion</a>
</span>
</span>
      ·
      <span class="dropdown">
<a href="#">Appendices</a>
<span class="dropdown-content" id="nav-appendices">
<a href="../license/">License</a>
<a href="../conduct/">Code of Conduct</a>
<a href="../contributing/">Contributing</a>
<a href="../bibliography/">Bibliography</a>
<a href="../glossary/">Glossary</a>
</span>
</span>
</nav>
<main>
<h1>OAuth 2.0 Authorization Framework</h1>
<p>When you click "Sign in with Google" on a website, you're using OAuth. When a mobile app requests access to your Twitter timeline, that's OAuth too. This protocol has become the standard way for applications to access user data without ever seeing the user's password. Understanding OAuth is essential for modern web development—it powers single sign-on, API access control, and third-party integrations across the internet.</p>
<p>OAuth 2.0 solves a fundamental problem: how do you give a third-party application limited access to your account without sharing your credentials? Before OAuth, users had to give their username and password to every app, which created security nightmares. OAuth introduces the concept of <strong>tokens</strong>—time-limited credentials with specific scopes that can be revoked without changing your password.</p>
<p>This pattern appears everywhere: GitHub uses OAuth for app permissions, Spotify for playlist access, Slack for bot integrations, and AWS for service-to-service authentication. Whether you're building a web app, mobile app, or API, you'll encounter OAuth.</p>
<h2>The OAuth Dance</h2>
<p>OAuth involves four parties working together:</p>
<ol>
<li><strong>Resource Owner</strong> (the user): Owns the data being accessed</li>
<li><strong>Client</strong> (the third-party app): Wants to access the user's data</li>
<li><strong>Authorization Server</strong>: Authenticates the user and issues tokens</li>
<li><strong>Resource Server</strong> (the API): Hosts the protected resources</li>
</ol>
<p>The authorization flow works like this:</p>
<ol>
<li><strong>Client requests authorization</strong>: App redirects user to authorization server</li>
<li><strong>User authenticates</strong>: User logs in and grants permission</li>
<li><strong>Server issues authorization code</strong>: One-time code sent to client</li>
<li><strong>Client exchanges code for token</strong>: Client authenticates itself and gets access token</li>
<li><strong>Client accesses resources</strong>: Uses token to call protected APIs</li>
</ol>
<p>The key insight is separation: the client never sees the user's password, and the token has limited scope and lifetime. This makes OAuth both secure and flexible.</p>
<h2>Authorization Code Flow</h2>
<p>The most common OAuth flow is the Authorization Code flow, designed for server-side applications:</p>
<div class="codehilite"><pre class=""><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">asimpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Environment</span><span class="p">,</span> <span class="n">Process</span><span class="p">,</span> <span class="n">Queue</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Set</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">string</span>


<span class="k">def</span><span class="w"> </span><span class="nf">generate_token</span><span class="p">(</span><span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"tok"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Generate a random token."""</span>
    <span class="n">random_part</span> <span class="o">=</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">16</span><span class="p">))</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">random_part</span><span class="si">}</span><span class="s2">"</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AuthorizationRequest</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Request for user authorization."""</span>
    <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">redirect_uri</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">scope</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">state</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># CSRF protection</span>
    <span class="n">response_queue</span><span class="p">:</span> <span class="n">Queue</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"AuthRequest(client=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">client_id</span><span class="si">}</span><span class="s2">, scope=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="si">}</span><span class="s2">)"</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AuthorizationResponse</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Response with authorization code."""</span>
    <span class="n">code</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">state</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"AuthResponse(code=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2">...)"</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TokenRequest</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Request to exchange code for access token."""</span>
    <span class="n">code</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">client_secret</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">redirect_uri</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">response_queue</span><span class="p">:</span> <span class="n">Queue</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"TokenRequest(client=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">client_id</span><span class="si">}</span><span class="s2">)"</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TokenResponse</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Response with access token."""</span>
    <span class="n">access_token</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">token_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"Bearer"</span>
    <span class="n">expires_in</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3600</span>
    <span class="n">refresh_token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">scope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"TokenResponse(token=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">access_token</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2">...)"</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ResourceRequest</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Request to access protected resource."""</span>
    <span class="n">access_token</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">resource_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">response_queue</span><span class="p">:</span> <span class="n">Queue</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"ResourceRequest(path=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">resource_path</span><span class="si">}</span><span class="s2">)"</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ResourceResponse</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Response from resource server."""</span>
    <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">"ResourceResponse(success=True)"</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"ResourceResponse(error=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="si">}</span><span class="s2">)"</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AuthorizationCode</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Authorization code with metadata."""</span>
    <span class="n">code</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">redirect_uri</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">scope</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">expires_at</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">used</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">now</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Check if code is still valid."""</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">used</span> <span class="ow">and</span> <span class="n">now</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">expires_at</span>


<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AccessToken</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Access token with metadata."""</span>
    <span class="n">token</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">scope</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">expires_at</span><span class="p">:</span> <span class="nb">float</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">now</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Check if token is still valid."""</span>
        <span class="k">return</span> <span class="n">now</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">expires_at</span>
</code></pre></div>
<p>These data structures represent the messages exchanged during OAuth flows. The authorization code is short-lived (typically 10 minutes), while access tokens last longer (often 1 hour).</p>
<h2>Authorization Server</h2>
<p>The authorization server handles user authentication and token issuance:</p>
<div class="codehilite"><pre class=""><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AuthorizationServer</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""OAuth 2.0 authorization server."""</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auth_queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token_queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">)</span>

        <span class="c1"># Registered clients</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clients</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Issued authorization codes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auth_codes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AuthorizationCode</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Issued access tokens</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">access_tokens</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AccessToken</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># User credentials (simplified - real systems use secure storage)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"alice@example.com"</span><span class="p">:</span> <span class="s2">"password123"</span><span class="p">,</span>
            <span class="s2">"bob@example.com"</span><span class="p">:</span> <span class="s2">"secret456"</span>
        <span class="p">}</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] Authorization Server started"</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">register_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                       <span class="n">redirect_uris</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">"""Register a new OAuth client."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clients</span><span class="p">[</span><span class="n">client_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"secret"</span><span class="p">:</span> <span class="n">client_secret</span><span class="p">,</span>
            <span class="s2">"redirect_uris"</span><span class="p">:</span> <span class="n">redirect_uris</span>
        <span class="p">}</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] Registered client: </span><span class="si">{</span><span class="n">client_id</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Main server loop."""</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># Handle both authorization and token requests</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">asimpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">FirstOf</span>

            <span class="n">name</span><span class="p">,</span> <span class="n">request</span> <span class="o">=</span> <span class="k">await</span> <span class="n">FirstOf</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">,</span>
                <span class="n">auth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_queue</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span>
                <span class="n">token</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">token_queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">"auth"</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_authorization_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">"token"</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_token_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_authorization_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">AuthorizationRequest</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Handle authorization request from client."""</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] AuthServer: Received </span><span class="si">{</span><span class="n">request</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="c1"># Validate client and redirect URI</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">client_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">clients</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] AuthServer: Unknown client </span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">client_id</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clients</span><span class="p">[</span><span class="n">request</span><span class="o">.</span><span class="n">client_id</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">redirect_uri</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">client</span><span class="p">[</span><span class="s2">"redirect_uris"</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] AuthServer: Invalid redirect URI"</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Simulate user authentication and consent</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># User login time</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] AuthServer: User authenticated, showing consent"</span><span class="p">)</span>

        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>  <span class="c1"># User consent time</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] AuthServer: User granted permissions: </span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="c1"># Generate authorization code</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">generate_token</span><span class="p">(</span><span class="s2">"code"</span><span class="p">)</span>
        <span class="n">auth_code</span> <span class="o">=</span> <span class="n">AuthorizationCode</span><span class="p">(</span>
            <span class="n">code</span><span class="o">=</span><span class="n">code</span><span class="p">,</span>
            <span class="n">client_id</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span>
            <span class="n">redirect_uri</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">redirect_uri</span><span class="p">,</span>
            <span class="n">scope</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">scope</span><span class="p">,</span>
            <span class="n">expires_at</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span> <span class="o">+</span> <span class="mi">600</span>  <span class="c1"># 10 minute expiry</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auth_codes</span><span class="p">[</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="n">auth_code</span>

        <span class="c1"># Send code to client</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">AuthorizationResponse</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">code</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">response_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] AuthServer: Issued authorization code"</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_token_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">TokenRequest</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Exchange authorization code for access token."""</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] AuthServer: Received </span><span class="si">{</span><span class="n">request</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="c1"># Validate client credentials</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">client_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">clients</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] AuthServer: Unknown client"</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">response_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
                <span class="n">TokenResponse</span><span class="p">(</span><span class="n">access_token</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">token_type</span><span class="o">=</span><span class="s2">"error"</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clients</span><span class="p">[</span><span class="n">request</span><span class="o">.</span><span class="n">client_id</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">client</span><span class="p">[</span><span class="s2">"secret"</span><span class="p">]</span> <span class="o">!=</span> <span class="n">request</span><span class="o">.</span><span class="n">client_secret</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] AuthServer: Invalid client secret"</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">response_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
                <span class="n">TokenResponse</span><span class="p">(</span><span class="n">access_token</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">token_type</span><span class="o">=</span><span class="s2">"error"</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Validate authorization code</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_codes</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] AuthServer: Invalid authorization code"</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">response_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
                <span class="n">TokenResponse</span><span class="p">(</span><span class="n">access_token</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">token_type</span><span class="o">=</span><span class="s2">"error"</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="n">auth_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_codes</span><span class="p">[</span><span class="n">request</span><span class="o">.</span><span class="n">code</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">auth_code</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] AuthServer: Authorization code expired or used"</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">response_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
                <span class="n">TokenResponse</span><span class="p">(</span><span class="n">access_token</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">token_type</span><span class="o">=</span><span class="s2">"error"</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">auth_code</span><span class="o">.</span><span class="n">client_id</span> <span class="o">!=</span> <span class="n">request</span><span class="o">.</span><span class="n">client_id</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] AuthServer: Code issued to different client"</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">response_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
                <span class="n">TokenResponse</span><span class="p">(</span><span class="n">access_token</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">token_type</span><span class="o">=</span><span class="s2">"error"</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">auth_code</span><span class="o">.</span><span class="n">redirect_uri</span> <span class="o">!=</span> <span class="n">request</span><span class="o">.</span><span class="n">redirect_uri</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] AuthServer: Redirect URI mismatch"</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">response_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
                <span class="n">TokenResponse</span><span class="p">(</span><span class="n">access_token</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">token_type</span><span class="o">=</span><span class="s2">"error"</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Mark code as used</span>
        <span class="n">auth_code</span><span class="o">.</span><span class="n">used</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Generate access token</span>
        <span class="n">access_token</span> <span class="o">=</span> <span class="n">generate_token</span><span class="p">(</span><span class="s2">"access"</span><span class="p">)</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">AccessToken</span><span class="p">(</span>
            <span class="n">token</span><span class="o">=</span><span class="n">access_token</span><span class="p">,</span>
            <span class="n">client_id</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span>
            <span class="n">scope</span><span class="o">=</span><span class="n">auth_code</span><span class="o">.</span><span class="n">scope</span><span class="p">,</span>
            <span class="n">expires_at</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span> <span class="o">+</span> <span class="mi">3600</span>  <span class="c1"># 1 hour expiry</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">access_tokens</span><span class="p">[</span><span class="n">access_token</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span>

        <span class="c1"># Issue token</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">TokenResponse</span><span class="p">(</span>
            <span class="n">access_token</span><span class="o">=</span><span class="n">access_token</span><span class="p">,</span>
            <span class="n">token_type</span><span class="o">=</span><span class="s2">"Bearer"</span><span class="p">,</span>
            <span class="n">expires_in</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span>
            <span class="n">scope</span><span class="o">=</span><span class="n">auth_code</span><span class="o">.</span><span class="n">scope</span>
        <span class="p">)</span>
        <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">response_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] AuthServer: Issued access token"</span><span class="p">)</span>
</code></pre></div>
<p>The authorization server is the trust anchor of OAuth. It verifies the user's identity, obtains consent, and issues tokens with appropriate scopes.</p>
<h2>Resource Server</h2>
<p>The resource server hosts the protected API:</p>
<div class="codehilite"><pre class=""><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ResourceServer</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""OAuth 2.0 resource server (protected API)."""</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_server</span><span class="p">:</span> <span class="n">AuthorizationServer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auth_server</span> <span class="o">=</span> <span class="n">auth_server</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource_queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">)</span>

        <span class="c1"># Protected resources</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resources</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"/api/profile"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"scope_required"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"profile"</span><span class="p">],</span>
                <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Alice"</span><span class="p">,</span> <span class="s2">"email"</span><span class="p">:</span> <span class="s2">"alice@example.com"</span><span class="p">}</span>
            <span class="p">},</span>
            <span class="s2">"/api/photos"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"scope_required"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"photos"</span><span class="p">],</span>
                <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"photos"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"photo1.jpg"</span><span class="p">,</span> <span class="s2">"photo2.jpg"</span><span class="p">,</span> <span class="s2">"photo3.jpg"</span><span class="p">]}</span>
            <span class="p">},</span>
            <span class="s2">"/api/messages"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"scope_required"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"messages"</span><span class="p">],</span>
                <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"messages"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"Hello!"</span><span class="p">,</span> <span class="s2">"How are you?"</span><span class="p">]}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] Resource Server started"</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Main server loop."""</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">request</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_resource_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_resource_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">ResourceRequest</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Handle API request with access token."""</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] ResourceServer: Received </span><span class="si">{</span><span class="n">request</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="c1"># Validate access token</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">access_token</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_server</span><span class="o">.</span><span class="n">access_tokens</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] ResourceServer: Invalid token"</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">response_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
                <span class="n">ResourceResponse</span><span class="p">(</span><span class="n">success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="s2">"invalid_token"</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_server</span><span class="o">.</span><span class="n">access_tokens</span><span class="p">[</span><span class="n">request</span><span class="o">.</span><span class="n">access_token</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] ResourceServer: Token expired"</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">response_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
                <span class="n">ResourceResponse</span><span class="p">(</span><span class="n">success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="s2">"token_expired"</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Check resource exists</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">resource_path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] ResourceServer: Resource not found"</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">response_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
                <span class="n">ResourceResponse</span><span class="p">(</span><span class="n">success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="s2">"not_found"</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Check token has required scope</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">[</span><span class="n">request</span><span class="o">.</span><span class="n">resource_path</span><span class="p">]</span>
        <span class="n">required_scopes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">resource</span><span class="p">[</span><span class="s2">"scope_required"</span><span class="p">])</span>
        <span class="n">token_scopes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">scope</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">required_scopes</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">token_scopes</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] ResourceServer: Insufficient scope"</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">response_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
                <span class="n">ResourceResponse</span><span class="p">(</span><span class="n">success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="s2">"insufficient_scope"</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Return protected resource</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] ResourceServer: Returning </span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">resource_path</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">response_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
            <span class="n">ResourceResponse</span><span class="p">(</span><span class="n">success</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">resource</span><span class="p">[</span><span class="s2">"data"</span><span class="p">])</span>
        <span class="p">)</span>
</code></pre></div>
<p>The resource server validates tokens and enforces scope-based access control. It doesn't need to know about users—only tokens and scopes.</p>
<h2>OAuth Client</h2>
<p>The client orchestrates the authorization flow:</p>
<div class="codehilite"><pre class=""><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">OAuthClient</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""OAuth 2.0 client application."""</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">redirect_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
             <span class="n">auth_server</span><span class="p">:</span> <span class="n">AuthorizationServer</span><span class="p">,</span> <span class="n">resource_server</span><span class="p">:</span> <span class="n">ResourceServer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span> <span class="o">=</span> <span class="n">client_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_secret</span> <span class="o">=</span> <span class="n">client_secret</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redirect_uri</span> <span class="o">=</span> <span class="n">redirect_uri</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auth_server</span> <span class="o">=</span> <span class="n">auth_server</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource_server</span> <span class="o">=</span> <span class="n">resource_server</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">access_token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] Client '</span><span class="si">{</span><span class="n">client_id</span><span class="si">}</span><span class="s2">' started"</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Demonstrate complete OAuth flow."""</span>
        <span class="c1"># Step 1: Request authorization</span>
        <span class="n">scopes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"profile"</span><span class="p">,</span> <span class="s2">"photos"</span><span class="p">]</span>
        <span class="n">code</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_authorization</span><span class="p">(</span><span class="n">scopes</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">code</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] Client: Authorization failed"</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Step 2: Exchange code for token</span>
        <span class="n">token_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">exchange_code_for_token</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">token_response</span> <span class="ow">or</span> <span class="n">token_response</span><span class="o">.</span><span class="n">token_type</span> <span class="o">==</span> <span class="s2">"error"</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] Client: Token exchange failed"</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">access_token</span> <span class="o">=</span> <span class="n">token_response</span><span class="o">.</span><span class="n">access_token</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] Client: Got access token!"</span><span class="p">)</span>

        <span class="c1"># Step 3: Access protected resources</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_resource</span><span class="p">(</span><span class="s2">"/api/profile"</span><span class="p">)</span>

        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_resource</span><span class="p">(</span><span class="s2">"/api/photos"</span><span class="p">)</span>

        <span class="c1"># Try accessing resource without permission</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_resource</span><span class="p">(</span><span class="s2">"/api/messages"</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">request_authorization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scopes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Step 1: Request user authorization."""</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] Client: Requesting authorization for </span><span class="si">{</span><span class="n">scopes</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="n">state</span> <span class="o">=</span> <span class="n">generate_token</span><span class="p">(</span><span class="s2">"state"</span><span class="p">)</span>  <span class="c1"># CSRF protection</span>
        <span class="n">response_queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">)</span>

        <span class="n">request</span> <span class="o">=</span> <span class="n">AuthorizationRequest</span><span class="p">(</span>
            <span class="n">client_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span>
            <span class="n">redirect_uri</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">redirect_uri</span><span class="p">,</span>
            <span class="n">scope</span><span class="o">=</span><span class="n">scopes</span><span class="p">,</span>
            <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span>
            <span class="n">response_queue</span><span class="o">=</span><span class="n">response_queue</span>
        <span class="p">)</span>

        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_server</span><span class="o">.</span><span class="n">auth_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response_queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="c1"># Validate state to prevent CSRF</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="n">state</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] Client: State mismatch - possible CSRF attack!"</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] Client: Received authorization code"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">code</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">exchange_code_for_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TokenResponse</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Step 2: Exchange authorization code for access token."""</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] Client: Exchanging code for token"</span><span class="p">)</span>

        <span class="n">response_queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">)</span>

        <span class="n">request</span> <span class="o">=</span> <span class="n">TokenRequest</span><span class="p">(</span>
            <span class="n">code</span><span class="o">=</span><span class="n">code</span><span class="p">,</span>
            <span class="n">client_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span>
            <span class="n">client_secret</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">client_secret</span><span class="p">,</span>
            <span class="n">redirect_uri</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">redirect_uri</span><span class="p">,</span>
            <span class="n">response_queue</span><span class="o">=</span><span class="n">response_queue</span>
        <span class="p">)</span>

        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_server</span><span class="o">.</span><span class="n">token_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response_queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">response</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">access_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Step 3: Access protected resource with token."""</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] Client: Accessing </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_token</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] Client: No access token!"</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">response_queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">)</span>

        <span class="n">request</span> <span class="o">=</span> <span class="n">ResourceRequest</span><span class="p">(</span>
            <span class="n">access_token</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">access_token</span><span class="p">,</span>
            <span class="n">resource_path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
            <span class="n">response_queue</span><span class="o">=</span><span class="n">response_queue</span>
        <span class="p">)</span>

        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_server</span><span class="o">.</span><span class="n">resource_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response_queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] Client: Success! Data: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">] Client: Failed - </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">error</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div>
<p>The client never sees the user's password. It gets an authorization code, exchanges it for a token, and uses the token to access APIs.</p>
<h2>Basic OAuth Simulation</h2>
<p>Let's see the complete flow in action:</p>
<div class="codehilite"><pre class=""><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run_basic_oauth_flow</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Demonstrate basic OAuth 2.0 authorization code flow."""</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">()</span>

    <span class="c1"># Create authorization server</span>
    <span class="n">auth_server</span> <span class="o">=</span> <span class="n">AuthorizationServer</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>

    <span class="c1"># Create resource server</span>
    <span class="n">resource_server</span> <span class="o">=</span> <span class="n">ResourceServer</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">auth_server</span><span class="p">)</span>

    <span class="c1"># Register client application</span>
    <span class="n">client_id</span> <span class="o">=</span> <span class="s2">"photo_app"</span>
    <span class="n">client_secret</span> <span class="o">=</span> <span class="s2">"secret_xyz"</span>
    <span class="n">redirect_uri</span> <span class="o">=</span> <span class="s2">"https://photoapp.example.com/callback"</span>

    <span class="n">auth_server</span><span class="o">.</span><span class="n">register_client</span><span class="p">(</span>
        <span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
        <span class="n">client_secret</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span>
        <span class="n">redirect_uris</span><span class="o">=</span><span class="p">[</span><span class="n">redirect_uri</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Create client</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">OAuthClient</span><span class="p">(</span>
        <span class="n">env</span><span class="p">,</span>
        <span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
        <span class="n">client_secret</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span>
        <span class="n">redirect_uri</span><span class="o">=</span><span class="n">redirect_uri</span><span class="p">,</span>
        <span class="n">auth_server</span><span class="o">=</span><span class="n">auth_server</span><span class="p">,</span>
        <span class="n">resource_server</span><span class="o">=</span><span class="n">resource_server</span>
    <span class="p">)</span>

    <span class="c1"># Run simulation</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">run_basic_oauth_flow</span><span class="p">()</span>
</code></pre></div>
<p>This demonstrates the complete OAuth dance: authorization request, user consent, code exchange, and API access.</p>
<h2>Security Considerations</h2>
<p>OAuth implementations must address several security concerns:</p>
<p><strong>State Parameter</strong>: Prevents CSRF attacks by ensuring the authorization response matches the original request.</p>
<p><strong>Authorization Code Expiry</strong>: Codes must be short-lived (typically 10 minutes) and single-use to prevent replay attacks.</p>
<p><strong>Client Authentication</strong>: Confidential clients must authenticate with client_secret when exchanging codes for tokens.</p>
<p><strong>Redirect URI Validation</strong>: Must exactly match the registered URI to prevent authorization code interception.</p>
<p><strong>Token Expiry</strong>: Access tokens should expire, forcing clients to refresh or re-authorize.</p>
<p><strong>HTTPS Only</strong>: All OAuth endpoints must use HTTPS to prevent token interception.</p>
<h2>Real-World OAuth Flows</h2>
<p>OAuth 2.0 defines several flows for different scenarios:</p>
<p><strong>Authorization Code Flow</strong> (our example): For server-side web apps that can securely store client_secret.</p>
<p><strong>PKCE Flow</strong>: For mobile and single-page apps that can't securely store secrets. Uses code_challenge and code_verifier.</p>
<p><strong>Implicit Flow</strong> (deprecated): Direct token issuance without code exchange. Replaced by Authorization Code + PKCE.</p>
<p><strong>Client Credentials Flow</strong>: For machine-to-machine authentication without user involvement.</p>
<p><strong>Resource Owner Password Flow</strong> (discouraged): Direct username/password exchange for tokens. Only for highly trusted clients.</p>
<h2>Refresh Tokens</h2>
<p>Access tokens expire quickly (typically 1 hour). Refresh tokens allow clients to get new access tokens without user interaction:</p>
<div class="codehilite"><pre class=""><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RefreshToken</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Refresh token for obtaining new access tokens."""</span>
    <span class="n">token</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">scope</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">expires_at</span><span class="p">:</span> <span class="nb">float</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">now</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">now</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">expires_at</span>
</code></pre></div>
<p>The authorization server can issue refresh tokens alongside access tokens. Clients use refresh tokens to get new access tokens when they expire, maintaining long-lived sessions without storing passwords.</p>
<h2>OpenID Connect</h2>
<p>OpenID Connect (OIDC) builds on OAuth 2.0 to add identity:</p>
<ul>
<li><strong>ID Token</strong>: JWT containing user identity claims (name, email, etc.)</li>
<li><strong>UserInfo Endpoint</strong>: API to retrieve additional user information</li>
<li><strong>Standard Scopes</strong>: openid, profile, email, address, phone</li>
</ul>
<p>OIDC enables single sign-on (SSO) across multiple applications while OAuth provides API access. They work together: OAuth says "what you can do," OIDC says "who you are."</p>
<h2>Token Introspection and Revocation</h2>
<p>Production OAuth systems need token management:</p>
<p><strong>Introspection</strong>: Resource servers can check token validity with the authorization server:</p>
<div class="codehilite"><pre class=""><span></span><code>POST /introspect
token=access_token_here
</code></pre></div>
<p><strong>Revocation</strong>: Users can revoke tokens through settings:</p>
<div class="codehilite"><pre class=""><span></span><code>POST /revoke
token=access_token_here
</code></pre></div>
<p>This enables security features like "sign out of all devices" and "revoke third-party app access."</p>
<h2>Conclusion</h2>
<p>OAuth 2.0 solves delegated authorization through token-based access control. The key principles are:</p>
<ol>
<li><strong>Separation of concerns</strong>: Client, auth server, and resource server have distinct roles</li>
<li><strong>No password sharing</strong>: Clients never see user credentials</li>
<li><strong>Limited scope</strong>: Tokens grant specific permissions, not full account access</li>
<li><strong>Time-limited access</strong>: Tokens expire, forcing periodic re-authorization</li>
<li><strong>Revocable</strong>: Users can revoke access without changing passwords</li>
</ol>
<p>OAuth has become the foundation for API security on the web. Combined with OpenID Connect, it enables both API access and identity federation. Understanding OAuth is essential for building modern applications—whether you're implementing social login, integrating third-party APIs, or designing your own API authorization.</p>
<p>Our simulation demonstrates the core OAuth mechanics: authorization requests, code exchange, token validation, and scope enforcement. Production systems add more complexity—PKCE for mobile apps, refresh tokens for long-lived sessions, JWT for distributed validation—but the fundamental pattern remains the same.</p>
</main>
<footer>
<div class="row">
<div class="col-3 left">
	  ⇐ <a href="../intro/">Introduction</a>
</div>
<div class="col-6 center">
<a href="../"></a>
	  © 2025
	  <a href="../#acknowledgments">the authors</a>
</div>
<div class="col-3 right">
<a href="../msgque/">A Message Queue</a> ⇒
	</div>
</div>
</footer>
</body>
</html>